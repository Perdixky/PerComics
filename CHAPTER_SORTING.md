# ğŸ¤– æ™ºèƒ½ç« èŠ‚æ’åºç³»ç»Ÿ

PerComics ä½¿ç”¨ AI é©±åŠ¨çš„æ™ºèƒ½æ’åºç³»ç»Ÿæ¥å¤„ç†å„ç§ç« èŠ‚å‘½åæ ¼å¼ã€‚

## âœ¨ ç‰¹æ€§

- **âš¡ è¶…å¿«é€Ÿè§„åˆ™å¼•æ“**ï¼š90%ä»¥ä¸Šçš„ç« èŠ‚é€šè¿‡è§„åˆ™è¯†åˆ«ï¼ˆæ¯«ç§’çº§ï¼‰
- **ğŸ§  AI å…œåº•**ï¼šå¤æ‚å‘½åæ‰å¯ç”¨ AI æ¨¡å‹ï¼ˆ77Må‚æ•°çš„ LaMini-Flan-T5ï¼‰
- **ğŸ›¡ï¸ å›é€€æœºåˆ¶**ï¼šå³ä½¿ AI å¤±è´¥ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ
- **ğŸŒ å¤šè¯­è¨€æ”¯æŒ**ï¼šè¯†åˆ«ä¸­è‹±æ–‡ç« èŠ‚å‘½å

## ğŸ“‹ æ”¯æŒçš„ç« èŠ‚æ ¼å¼

### âœ… æ ‡å‡†ç« èŠ‚ï¼ˆè§„åˆ™è¯†åˆ«ï¼‰
- `Chapter 123` / `Ch 123`
- `Episode 123` / `Ep 123`
- `#123`
- `001`, `002`, `150`ï¼ˆçº¯æ•°å­—ï¼‰
- `ç¬¬123è¯` / `123è¯` / `ç¬¬123é›†`

### âœ… å°æ•°ç« èŠ‚
- `Chapter 1.5`
- `Ch 2.3`
- `ç¬¬1.5è¯`

### âœ… ç‰¹æ®Šç« èŠ‚
- `Prologue` / `åºç« ` â†’ æ’åœ¨æœ€å‰ï¼ˆnumber: 0ï¼‰
- `Epilogue` / `å°¾å£°` â†’ æ’åœ¨æœ€åï¼ˆnumber: 9999ï¼‰
- `Extra` / `Bonus` / `ç•ªå¤–` / `ç‰¹åˆ«ç¯‡` â†’ æ™®é€šç« èŠ‚ä¹‹åï¼ˆnumber: 9000+ï¼‰
- `Side Story 2` â†’ å¸¦ç¼–å·çš„ç‰¹æ®Šç« èŠ‚ï¼ˆnumber: 9002ï¼‰

### âš ï¸ å¤æ‚å‘½åï¼ˆAI å¤„ç†ï¼‰
- `Christmas Special 2023`
- `Random Folder Name`
- å…¶ä»–æ— æ³•è¯†åˆ«çš„å‘½å â†’ å›é€€æ’åºï¼ˆnumber: 9500ï¼‰

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### è¿è¡Œæ‰«æå™¨
```bash
npm run scan
```

æ‰«æå™¨ä¼šè‡ªåŠ¨ï¼š
1. è¯»å– `comics/` ç›®å½•ä¸‹çš„æ‰€æœ‰æ¼«ç”»
2. ä½¿ç”¨æ™ºèƒ½æ’åºç³»ç»Ÿå¯¹ç« èŠ‚è¿›è¡Œæ’åº
3. ç”Ÿæˆ `manifest.json`
4. æ˜¾ç¤ºæ’åºç»Ÿè®¡ï¼ˆè§„åˆ™è¯†åˆ« vs AI è¯†åˆ«ï¼‰

### è¾“å‡ºç¤ºä¾‹
```
ğŸ“š Scanning comics directory...
   ğŸ“– Sorting 15 chapters for "One Punch Man"...
   âœ“ Parsed 15 chapters
   ğŸ“ Rule-based: 14, ğŸ¤– AI-based: 1
```

## ğŸ¯ æ’åºè§„åˆ™

ç« èŠ‚æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§æ’åºï¼ˆ**å€’åº**ï¼Œæœ€æ–°ç« èŠ‚åœ¨å‰ï¼‰ï¼š

```
Epilogue (9999)
    â†‘
Special/Bonus/Extra (9000-9999)
    â†‘
Unknown/Fallback (9500)
    â†‘
Normal Chapters (1-8999)
    â†‘
Decimal Chapters (1.5, 2.3, etc.)
    â†‘
Prologue (0)
```

## âš™ï¸ é…ç½®é€‰é¡¹

åœ¨ `scan_comics.js` ä¸­å¯ä»¥è°ƒæ•´ AI æ’åºå™¨çš„è¡Œä¸ºï¼š

```javascript
const sortedChapters = await sortChaptersWithAI(chapterFolders, {
    reverseOrder: true,  // æœ€æ–°ç« èŠ‚åœ¨å‰ï¼ˆæ ‡å‡†æ¼«ç”»ç«™è¡Œä¸ºï¼‰
    useAI: true,         // å¯ç”¨ AI å¤„ç†å¤æ‚å‘½å
    showProgress: false  // æ˜¾ç¤ºè¯¦ç»†å¤„ç†è¿›åº¦
});
```

### ç¦ç”¨ AIï¼ˆä»…ä½¿ç”¨è§„åˆ™ï¼‰
å¦‚æœä¸æƒ³ä¸‹è½½ AI æ¨¡å‹ï¼Œå¯ä»¥è®¾ç½® `useAI: false`ï¼š

```javascript
const sortedChapters = await sortChaptersWithAI(chapterFolders, {
    useAI: false  // ç¦ç”¨ AIï¼Œåªä½¿ç”¨è§„åˆ™
});
```

è¿™æ ·åªä¼šä½¿ç”¨å¿«é€Ÿè§„åˆ™å¼•æ“ï¼Œæ— æ³•è¯†åˆ«çš„ç« èŠ‚ä¼šä½¿ç”¨è‡ªç„¶æ’åºã€‚

## ğŸ§ª æµ‹è¯•æ’åºå™¨

å•ç‹¬æµ‹è¯•ç« èŠ‚æ’åºé€»è¾‘ï¼š

```bash
node aiChapterSorter.js
```

è¿™ä¼šè¿è¡Œå†…ç½®çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå±•ç¤ºå„ç§å‘½åæ ¼å¼çš„æ’åºç»“æœã€‚

## ğŸ“Š æ€§èƒ½

- **è§„åˆ™è¯†åˆ«**ï¼š<1ms per chapter
- **AI è¯†åˆ«**ï¼šé¦–æ¬¡åŠ è½½æ¨¡å‹ ~3-5ç§’ï¼Œä¹‹åæ¯ç« èŠ‚ ~50-100ms
- **å†…å­˜å ç”¨**ï¼šAI æ¨¡å‹ ~200MBï¼ˆé‡åŒ–åï¼‰

## ğŸ¨ è‡ªå®šä¹‰è§„åˆ™

æƒ³æ·»åŠ æ–°çš„è¯†åˆ«è§„åˆ™ï¼Ÿç¼–è¾‘ `aiChapterSorter.js` ä¸­çš„ `quickParse()` å‡½æ•°ï¼š

```javascript
// æ·»åŠ æ–°çš„æ­£åˆ™æ¨¡å¼
const patterns = [
    /(?:chapter|ch|ep|episode|è¯|è©±|é›†|#)[\s.-]*(\d+(?:\.\d+)?)/i,
    // åœ¨è¿™é‡Œæ·»åŠ ä½ çš„è‡ªå®šä¹‰æ¨¡å¼
    /custom-pattern-(\d+)/i
];
```

## ğŸ› æ•…éšœæ’é™¤

### AI æ¨¡å‹åŠ è½½å¤±è´¥
```
âš  AI extraction failed: fetch failed
```

**åŸå› **ï¼šé¦–æ¬¡è¿è¡Œæ—¶éœ€è¦ä¸‹è½½æ¨¡å‹ï¼ˆ~200MBï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
2. æˆ–è€…ç¦ç”¨ AIï¼šè®¾ç½® `useAI: false`
3. ç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ°è§„åˆ™è¯†åˆ«ï¼Œä¸å½±å“æ­£å¸¸ä½¿ç”¨

### ç« èŠ‚é¡ºåºä¸å¯¹
1. æ£€æŸ¥æ–‡ä»¶å¤¹å‘½åæ˜¯å¦ç¬¦åˆæ ‡å‡†æ ¼å¼
2. è¿è¡Œæµ‹è¯•æŸ¥çœ‹è¯†åˆ«ç»“æœï¼š`node aiChapterSorter.js`
3. æŸ¥çœ‹ manifest.json ä¸­çš„ `_meta` å­—æ®µäº†è§£è¯†åˆ«è¯¦æƒ…

## ğŸ“ Manifest å…ƒæ•°æ®

ç”Ÿæˆçš„ `manifest.json` åŒ…å«æ¯ä¸ªç« èŠ‚çš„è¯†åˆ«å…ƒæ•°æ®ï¼š

```json
{
  "id": "comic-chapter-1",
  "title": "Chapter 1",
  "number": 1,
  "pages": [...],
  "_meta": {
    "confidence": 1.0,
    "source": "rule",
    "type": "normal"
  }
}
```

- `confidence`: è¯†åˆ«ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰
- `source`: è¯†åˆ«æ¥æºï¼ˆ`rule` / `ai` / `fallback`ï¼‰
- `type`: ç« èŠ‚ç±»å‹ï¼ˆ`normal` / `special` / `prologue` / `epilogue`ï¼‰

## ğŸ’¡ æç¤º

1. **æ ‡å‡†å‘½åæœ€ä½³**ï¼šä½¿ç”¨ `Chapter 1`, `Chapter 2` è¿™æ ·çš„å‘½åå¯è·å¾—æœ€ä½³æ€§èƒ½
2. **é¿å…å¥‡æ€ªå­—ç¬¦**ï¼šç‰¹æ®Šå­—ç¬¦å¯èƒ½å½±å“è¯†åˆ«å‡†ç¡®åº¦
3. **ä¸€è‡´æ€§**ï¼šåŒä¸€æ¼«ç”»ä¸‹ä¿æŒå‘½åé£æ ¼ä¸€è‡´

## ğŸ”§ æŠ€æœ¯æ ˆ

- **è§„åˆ™å¼•æ“**ï¼šæ­£åˆ™è¡¨è¾¾å¼ + è‡ªç„¶æ’åº
- **AI æ¨¡å‹**ï¼šXenova/LaMini-Flan-T5-77Mï¼ˆé‡åŒ–ï¼‰
- **è¿è¡Œæ—¶**ï¼šTransformers.js (ONNX Runtime)
